---

layout: post
title: "å¦‚ä½•æ­å»ºè‡ªå·±çš„GitHubé•œåƒç«™"
date: 2024-04-16 20:30:14 -0700
categories: php
---

> ä½œè€…:21çº§è®¡ç®—æœºåº”ç”¨æœ¬ç§‘3ç­ è°¢å’æ¶µ
# Githubé•œåƒç«™æ­å»ºæ•™ç¨‹

> ä¸ºä»€ä¹ˆè¦ä¸“é—¨åšè¿™ä¸€æœŸæ•™ç¨‹å‘¢,å› ä¸ºåœ¨China mainland,è®¿é—®GitHubå…¶å®å¶å°”ä¼šæŠ½é£,å¯¼è‡´æˆ‘ä»¬åœ¨forkåˆ«äººé¡¹ç›®æˆ–è€…æ‰¾å¼€æºé¡¹ç›®éƒ½é€ æˆä¸€å®šçš„å›°æ‰°.è¿˜æœ‰å°±æ˜¯å‘ç°å¾ˆå¤šåŒå­¦å…¶å®å¾ˆå°‘æœºä¼šå¯ä»¥è®¤è¯†åˆ°è¿™ä¸ªç½‘ç«™çš„ä¼˜ç‚¹æˆ–è€…è¯´è·‘åˆ°Giteeä¸Šå»å…¬å¼€è‡ªå·±çš„é¡¹ç›®,ä½†æ˜¯Giteeçš„ä½“é‡å®åœ¨å¤ªå°äº†,æˆ‘ä¹Ÿæ˜¯ä»Šå¤©æ‰æ³¨å†Œäº†æˆ‘çš„Giteeè´¦å·,æ¯”èµ·æˆ‘Githubçš„è´¦å·æ™šäº†3å¹´å¤šæ—¶é—´.OK,æˆ‘ä»¬å°±è¯´åˆ°è¿™,å¼€å§‹æ•™ç¨‹.
>
> *æ³¨æ„*:æœ¬æ¬¡æ•™ç¨‹æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦è‡ªå·±å»ä»˜è´¹çš„åœ°æ–¹,å°±æ˜¯**<font color="red">è´­ä¹°åŸŸå</font>**,å‰©ä¸‹çš„åŸºæœ¬0æˆæœ¬,ä½ å¯ä»¥è‡ªå·±å»è¯•è¯•,å»ºç½‘ç«™å¯¹ä¸€ä¸ªå¼€å‘è€…æ¥è¯´è¿˜æ˜¯æœ‰å¥½å¤„çš„

## å†…å®¹

1. **éœ€è¦ä¸€ä¸ªè‡ªå·±çš„åŸŸå**

	**è¿™é‡Œæ¨èä¸€ä¸ªè´­ä¹°åŸŸåçš„ç½‘ç«™**:`https://wanwang.aliyun.com/domain`(é˜¿é‡Œä¸‡å›½åŸŸåæ³¨å†Œ),æˆ‘ä»¬é¦–å…ˆæ³¨å†Œä¸€ä¸‹è‡ªå·±çš„é˜¿é‡Œäº‘è´¦å·

	![é˜¿é‡Œäº‘ä¸‡å›½åŸŸåæ³¨å†Œå®˜ç½‘](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/1.png)

	æˆ‘ä»¬ç‚¹å‡»å³ä¸Šè§’çš„ç«‹å³æ³¨å†Œ,è¿™ä¸€æ­¥æˆ‘å°±ä¸æ¼”ç¤ºäº†

	ç„¶å,æˆ‘ä»¬åœ¨è¿™é‡Œè¾“å…¥ä½ æƒ³åˆ›å»ºçš„ä¸€ä¸ªåŸŸåå

	![è¿™é‡Œè¾“å…¥](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/2.png)

	**å¯ä»¥é€‰æ‹©è‡ªå·±æƒ³è¦çš„é¡¶çº§åŸŸå,è¿™é‡Œæ¨è`.top`çš„é¡¶çº§åŸŸ,é¦–å¹´17,å†ç»­è´¹ä¹Ÿä¸è´µ**

	æˆ‘è¿™é‡Œå°±é€‰æ‹©çš„æ˜¯*.com*æ¼”ç¤º,å› ä¸ºæˆ‘è‡ªå·±å·²ç»æ³¨å†Œäº†*.cnå’Œ.top*

	![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/3.png)

	æˆ‘ä»¬æ‰¾ä¸€ä¸ªæ·»åŠ è¿›æ¸…å•

	![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/4.png)

	ç‚¹å‡»ç«‹å³è´­ä¹°,æˆ‘å°±ä¸æ¼”ç¤ºäº†,ğŸ˜‚è€å¸ˆåº”è¯¥ä¸ä¼šç»™æˆ‘æŠ¥é”€çš„,å¦‚æœæœ‰åç»­çš„åŒå­¦æ„¿æ„åŠ å…¥è‡ªå·±çš„å›¾ç‰‡ä¹Ÿè¡Œ,å…è®¸ç›´æ¥ä¿®æ”¹æ·»åŠ 

	åæ­£ä¸‹ç»­æ­¥éª¤å°±æ˜¯è´­ä¹°,ç„¶åè¿›è¡Œå®åè®¤è¯,**<font color="red">æ³¨æ„:è¿™é‡Œçš„è®¤è¯ä¸ç”¨å»ICPå¤‡æ¡ˆ,æˆ‘ä»¬ä¸ç”¨åˆ°å›½å†…çš„æœåŠ¡å™¨,ä¸ç”¨å»åš.åªéœ€è¦ä½ å¤‡æ¡ˆåŸŸåå°±è¡Œ</font>**

	ä¸Šé¢æ­¥éª¤åšå®Œä¹‹å,ä½ å¯ä»¥åœ¨è¿™ä¸ªæ§åˆ¶å°çœ‹åˆ°ä½ çš„æ³¨å†Œçš„åŸŸå

	![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/5.png)

	ç„¶åæˆ‘ä»¬,ç‚¹å‡»å³è¾¹è¿™ä¸ª*è§£æ*,æˆ‘ä»¬è¦æŠŠè¿™ä¸ªæš‚æ—¶ä¿å­˜åœ¨æœ¬åœ°

	å°±åœ¨è¿™é‡Œ

	![è§£æ](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/6.png)

	![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/7.png)

	æŠŠå³è¾¹ä¸¤è¡Œå†…å®¹ä¿å­˜ä¸‹,ä»¥ä¾¿ä½ ä»¥åèƒ½æå…¶ä»–å†…å®¹.

	**è¿™é‡Œçš„è¯,æˆ‘ä»¬æ˜¯æŠŠåŸŸåå·²ç»è´­ä¹°åˆ°äº†,ä½ æœ‰äº†ä¸“å±è‡ªå·±çš„åŸŸå(è®°å¾—æ¯å¹´ä»˜è´¹å°±è¡Œ)**

	2. æˆ‘ä»¬æ¥ä¸‹æ¥å»è¿™ä¸ªç½‘ç«™`https://www.cloudflare.com/zh-cn/`

		![Cloudflare](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/8.png)

		æœ‰è´¦å·å°±ç™»å½•,æ²¡æœ‰è‡ªå·±å»æ³¨å†Œä¸€ä¸ªå§

		![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/9.png)

		æ¥ä¸‹æ¥:*è¿›å…¥æ§åˆ¶å°,æ–°æ·»ä½ çš„åŸŸå*

		![è¿™é‡Œ](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/10.png)

		![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/11.png)

		è¿™é‡Œæˆ‘ä»¬è¦é€‰æ‹©:**å…è´¹è®¡åˆ’**(å¦‚æœä½ è·Ÿæˆ‘ä¸€æ ·,è®¿é—®é‡æ¯”è¾ƒå¤§,å»ºè®®ä¹°Proè®¡åˆ’,*éœ€è¦ä¸‡äº‹è¾¾å¡æˆ–è€…Visaåˆ·ç¾åˆ€*)

		ç¬¬äºŒæ­¥æˆ‘ä»¬ç›´æ¥ä¸ç”¨ç®¡,çœºåˆ°ç¬¬ä¸‰æ­¥

		![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/12.png)

		ä¿å­˜ä¸‹é¢çš„é‚£ä¸ª`CloudflareåŸŸåæœåŠ¡å™¨`,ä¸¤è¡Œ,å¾ˆé‡è¦

		ç„¶å,ç›´æ¥ä¸‹ä¸€æ­¥,å®Œæˆ,**ç¨åå®Œæˆ**

		3. ç„¶åæˆ‘ä»¬å›åˆ°ç¬¬ä¸€æ­¥çš„ä¸‡å›½åŸŸåç½‘çš„æ§åˆ¶å°,

			![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/13.png)

			ç‚¹å‡»å›¾ä¸Šçš„ä¿®æ”¹dns,å°†åŸŸåè§£æç»™`Cloudflare`æ‰˜ç®¡

			å¡«å…¥å¥½å,å¯èƒ½è¦ç­‰ä¸ª24h,ä¸ç¡®å®šæœ‰å¤šå¿«,ä½†æœ€æ…¢ä¸è¶…è¿‡24H.**ä¸€èˆ¬15minå°±è¡Œ**

			ç„¶åä½ åˆ°`CloudFlare`æ§åˆ¶å°,å¯ä»¥çœ‹åˆ°ä½ çš„åŸŸåå·²ç»Activeäº†

			ç»§ç»­ä¸‹ä¸€æ­¥

			4. ä¸“é—¨æäº†ä¸ªæ–°åŸŸå,çœ‹å›¾

				![Successçš„å›¾](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/14.png)

				æ‰¾åˆ°çº¢æ¡†æ¡†çš„ä½ç½®ç‚¹ä»–å‘€

				![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/15.png)

				ç„¶åæ˜¯è¿™ä¸ªç®¡ç†workå®ä¾‹

				![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/16.png)

				åˆ›å»ºä¸€ä¸ªå®ä¾‹

				![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/17.png)

				ç‚¹å‡»è¿™ä¸ª`Works`ä¸‹çš„åˆ›å»ºæ–°**Works**

				![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/18.png)

				`name`ä»»æ„,ç„¶åç¡®å®š

				çœ‹åˆ°è¿™ä¸ª

				![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/19.png)

				å¥½äº†,ä¸‹ä¸€æ­¥

				5. ç‚¹å‡»è¿™é‡Œ

					![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/20.png)

					![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/21.png)

					åˆ°ç‚¹è¿™é‡Œ,è¾“å…¥ä½ çš„Code

					æˆ‘å·²ç»å°†è„šæœ¬å†™å¥½,ç›´æ¥æ‹¿å»ç”¨,

					ç”¨çš„æ˜¯*JavaScript*

					```JavaScript
					// å®šä¹‰ä¸€ä¸ªGithubç½‘ç«™,ç”¨æœ€ç»ˆå˜é‡.
					const upstream = 'www.github.com'
					
					// é•œåƒç½‘ç«™çš„ç›®å½•ï¼Œæ¯”å¦‚ä½ æƒ³é•œåƒæŸä¸ªç½‘ç«™çš„äºŒçº§ç›®å½•åˆ™å¡«å†™äºŒçº§ç›®å½•çš„ç›®å½•åï¼Œé•œåƒ GitHub ç”¨ä¸åˆ°ï¼Œé»˜è®¤å³å¯.
					const upstream_path = '/'
					
					// é•œåƒç«™æ˜¯å¦æœ‰æ‰‹æœºè®¿é—®ä¸“ç”¨ç½‘å€ï¼Œæ²¡æœ‰åˆ™å¡«ä¸€æ ·çš„.
					const upstream_mobile = 'www.github.com'
					
					// å±è”½å›½å®¶å’Œåœ°åŒº,è¿™é‡Œè¦é˜²æ­¢è§¦å‘å…¶ä»–å›½å®¶çš„é£æ§.
					// è¯·éµå®ˆå½“åœ°å›½å®¶çš„æ³•å¾‹æ³•è§„,æˆ‘çš„æ•°å­—èº«ä»½æ˜¯Hong Kong,æ‰€ä»¥ç›¸å¯¹æ¥è¯´ä¸ç”¨æ‹…å¿ƒè§¦å‘é£æ§,è¿™é‡Œä¸€å®šè¦å¡«å†™çš„å›½å®¶æ˜¯æœé²œ,å‰©ä¸‹çš„ä½ å»å¡«
					const blocked_region = ['KP', 'SY', 'PK', 'CU']
					
					// å±è”½ IP åœ°å€.
					// é˜²æ­¢å…¨å±€è§¦å‘å’Œæœ¬åœ°å›ç¯
					const blocked_ip_address = ['0.0.0.0', '127.0.0.1']
					
					// é•œåƒç«™æ˜¯å¦å¼€å¯ HTTPS.
					// ä¸€å®šå¼€https,æ‰€ä»¥ä¸è¦åŠ¨
					const https = true
					
					// æ–‡æœ¬æ›¿æ¢.
					const replace_dict = {
					    '$upstream': '$custom_domain',
					    '//github.com': ''
					}
					
					// ä»¥ä¸‹ä¿æŒé»˜è®¤ï¼Œä¸è¦åŠ¨
					addEventListener('fetch', event => {
					    event.respondWith(fetchAndApply(event.request));
					})
					
					async function fetchAndApply(request) {
					
					    const region = request.headers.get('cf-ipcountry').toUpperCase();
					    const ip_address = request.headers.get('cf-connecting-ip');
					    const user_agent = request.headers.get('user-agent');
					
					    let response = null;
					    let url = new URL(request.url);
					    let url_hostname = url.hostname;
					
					    if (https == true) {
					        url.protocol = 'https:';
					    } else {
					        url.protocol = 'http:';
					    }
					
					    if (await device_status(user_agent)) {
					        var upstream_domain = upstream;
					    } else {
					        var upstream_domain = upstream_mobile;
					    }
					
					    url.host = upstream_domain;
					    if (url.pathname == '/') {
					        url.pathname = upstream_path;
					    } else {
					        url.pathname = upstream_path + url.pathname;
					    }
					
					    if (blocked_region.includes(region)) {
					        response = new Response('Access denied: WorkersProxy is not available in your region yet.', {
					            status: 403
					        });
					    } else if (blocked_ip_address.includes(ip_address)) {
					        response = new Response('Access denied: Your IP address is blocked by WorkersProxy.', {
					            status: 403
					        });
					    } else {
					        let method = request.method;
					        let request_headers = request.headers;
					        let new_request_headers = new Headers(request_headers);
					
					        new_request_headers.set('Host', url.hostname);
					        new_request_headers.set('Referer', url.hostname);
					
					        let original_response = await fetch(url.href, {
					            method: method,
					            headers: new_request_headers
					        })
					
					        let original_response_clone = original_response.clone();
					        let original_text = null;
					        let response_headers = original_response.headers;
					        let new_response_headers = new Headers(response_headers);
					        let status = original_response.status;
					
					        new_response_headers.set('access-control-allow-origin', '*');
					        new_response_headers.set('access-control-allow-credentials', true);
					        new_response_headers.delete('content-security-policy');
					        new_response_headers.delete('content-security-policy-report-only');
					        new_response_headers.delete('clear-site-data');
					
					        const content_type = new_response_headers.get('content-type');
					        if (content_type.includes('text/html') && content_type.includes('UTF-8')) {
					            original_text = await replace_response_text(original_response_clone, upstream_domain, url_hostname);
					        } else {
					            original_text = original_response_clone.body
					        }
					
					        response = new Response(original_text, {
					            status,
					            headers: new_response_headers
					        })
					    }
					    return response;
					}
					
					async function replace_response_text(response, upstream_domain, host_name) {
					    let text = await response.text()
					
					    var i, j;
					    for (i in replace_dict) {
					        j = replace_dict[i]
					        if (i == '$upstream') {
					            i = upstream_domain
					        } else if (i == '$custom_domain') {
					            i = host_name
					        }
					
					        if (j == '$upstream') {
					            j = upstream_domain
					        } else if (j == '$custom_domain') {
					            j = host_name
					        }
					
					        let re = new RegExp(i, 'g')
					        text = text.replace(re, j);
					    }
					    return text;
					}
					
					
					async function device_status(user_agent_info) {
					    var agents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
					    var flag = true;
					    for (var v = 0; v < agents.length; v++) {
					        if (user_agent_info.indexOf(agents[v]) > 0) {
					            flag = false;
					            break;
					        }
					    }
					    return flag;
					}
					```

					å¦‚æœä½ è§‰å¾—ä¸Šé¢çš„å†…å®¹,ä¸ç¬¦åˆä½ çš„,è¯·è‡ªå·±ä¿®æ”¹

					![](/1x-web-certificate-gkd/assets/GitHub-mirror/22.png)

					ç„¶åç‚¹å‡»**éƒ¨ç½²å°±è¡Œ**

					å¾ˆæŠ±æ­‰,æˆ‘å›¾ç‰‡æ‰“ç ,å› ä¸ºæˆ‘æœ‰ä¸€äº›ä¿®æ”¹å’Œå…¶ä»–ç”¨,ä½ æ ¹æ®ä¸Šé¢ç”¨å°±è¡Œ

					æå®šå,ä½ å°±å¯ä»¥åœ¨è¿™ä¸ªé¡µé¢`yourDepoyName.pages.dev`çœ‹åˆ°æˆæœ(éœ€è¦ç§‘å­¦ä¸Šç½‘)

					6. è¿™é‡Œå°±ä½“ç°ä¸€ä¸ªåŸŸåå¥½å¤„

						![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/23.png)

						ç‚¹å‡»`Custom Domain`,è®°å¾—ä½ éœ€è¦å†™å…¥äºŒçº§åŸŸå

						æ³¨æ„

						**åŸŸå(Domain)**:*æœ€åé¢çš„é‚£ä¸€ä¸ª`.cn`æ˜¯é¡¶çº§åŸŸ,,ç„¶åä½ çš„`example.cn`ä¸­çš„exampleæ˜¯ä¸€çº§åŸŸå,`xxx.example.cn`ä¸­çš„xxxæ˜¯äºŒçº§åŸŸå*

						![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/24.png)

						å°†è¿™ä¸€è¡Œçš„å†…å®¹å¯¼å…¥åˆ°cloudflareé‡Œ,**ä¸€èˆ¬ä¼šè‡ªåŠ¨å¯¼å…¥**

						å¥½äº†,æˆ‘ä»¬å»åˆ°è‡ªå·±çš„åŸŸå

						`xxx.example.xx`

						æˆåŠŸæˆªå›¾æ˜¯è¿™æ ·çš„

						![](https://raw.githubusercontent.com/hingsli/1x-web-certificate-gkd/main/assets/GitHub-mirror/25.png)

						ç„¶åä½ å¯ä»¥åœ¨å¼€æºçš„æ˜Ÿè¾°å¤§æµ·é¨æ¸¸å“¦

					# é¡¹ç›®ç»“å°¾

					> æ³¨æ„,è¿™ç§æ–¹å¼éƒ¨ç½²çš„é•œåƒä¸èƒ½ç™»å½•è‡ªå·±çš„è´¦å·,GitHubæ›´æ–°äº†ç›¸åº”çš„è§„åˆ™,ä¸èƒ½ç”¨è¿™ä¸ªç™»å½•,ä½†æ˜¯æ‹‰å–è¯·æ±‚å•Šæˆ–è€…æ˜¯cloneéƒ½æ˜¯OKçš„
					>
					> åç»­æœ‰äººèƒ½è§£å†³ä¹Ÿå¯ä»¥å¸®æˆ‘ä¿®æ”¹,æˆ‘å·²ç»ä¸ç”¨è¿™ä¸ªæ–¹æ³•å¾ˆä¹…äº†,å¯èƒ½è¿‡æ—¶ä½†æ˜¯å¯ä»¥ç”¨

					> è°¢è°¢çœ‹åˆ°è¿™é‡Œ,å¸Œæœ›èƒ½ä¸ºå¼€æºé¡¹ç›®åšå‡ºä¸€ä»½åŠ›é‡ğŸ‰ğŸ‰ğŸ‰
					>
					> **è®©æˆ‘ä»¬å‰å¾€å¼€æºçš„æ˜Ÿè¾°å¤§æµ·,æ¯ä¸€ä¸ªäººä¸€å®šæ˜¯æœ€é—ªäº®çš„æ˜Ÿæ˜Ÿâœ¨**

	

	